(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const f=20,h=14,C=30,E=[[[1,1],[1,1]],[[1,1,1,1]],[[0,1,0],[1,1,1]],[[1,0],[1,1],[0,1]],[[0,1],[1,1],[1,0]],[[1,0],[1,0],[1,1]],[[0,1],[0,1],[1,1]]];function w(){return E[Math.floor(Math.random()*E.length)]}function x(n,e){return Array(e).fill(0).map(()=>Array(n).fill(0))}function L(){return{board:x(h,C),piece:{position:{x:5,y:7},shape:w()},nextShape:w(),score:0}}function d(n,e){return e.shape.some((t,i)=>t.some((o,r)=>{var v;const s=(v=n[e.position.y+i])==null?void 0:v[e.position.x+r];return s===void 0?!0:s===1&&o===1}))}function R(n){const e=structuredClone(n),t=[];return e.board.forEach((i,o)=>{i.every(r=>r===1)&&t.push(o)}),t.forEach(i=>{e.board.splice(i,1);const o=Array(h).fill(0);e.board.unshift(o)}),e.score+=100*t.length,e}function A(n){const e=structuredClone(n);return e.piece.shape.forEach((t,i)=>{t.forEach((o,r)=>{var s;o===1&&((s=e.board[i+e.piece.position.y])==null?void 0:s[r+e.piece.position.x])!==void 0&&(e.board[i+e.piece.position.y][r+e.piece.position.x]=1)})}),e.piece.shape=structuredClone(e.nextShape),e.piece.position.x=h/2,e.piece.position.y=0,e.nextShape=w(),e.score+=10,d(e.board,e.piece)&&(e.board.forEach(t=>t.fill(0)),window.alert("Ha ha")),e}function H(n){const e=[];for(let t=0;t<n[0].length;t++){const i=[];for(let o=n.length-1;o>=0;o--)i.push(n[o][t]);e.push(i)}return e}function S(n){const e=structuredClone(n),t=structuredClone(e.piece);return t.position.y++,d(e.board,t)?R(A(e)):(e.piece.position=t.position,e)}function T(n){const e=structuredClone(n),t=structuredClone(e.piece);return t.position.x--,d(e.board,t)||(e.piece.position=t.position),e}function O(n){const e=structuredClone(n),t=structuredClone(e.piece);return t.position.x++,d(e.board,t)||(e.piece.position=t.position),e}function P(n){const e=structuredClone(n),t=structuredClone(e.piece);return t.shape=H(t.shape),d(e.board,t)||(e.piece.shape=t.shape),e}const a=document.querySelector("#board"),u=document.querySelector("#next"),y=document.querySelector("#score");if(a===null||u===null||y===null)throw new Error("Something is wrong with the tags IDs");const D=a instanceof HTMLCanvasElement&&u instanceof HTMLCanvasElement;if(!D)throw new Error("Elements are not canvas tags");a.width=f*h;a.height=f*C;u.width=f*4;u.height=f*4;const l=a.getContext("2d"),p=u.getContext("2d");if(l===null||p===null)throw new Error("Unable to retrive 2d context from canvas elements");l.scale(f,f);p.scale(f,f);let c=L(),m=0,g=0;function b(n=0){G(c);const e=n-g;g=n,m+=e,m>1e3&&(c=S(c),m=0),window.requestAnimationFrame(b)}function G(n){if(a===null||u===null||y===null)throw new Error("Something is wrong with the tags IDs");if(!(a instanceof HTMLCanvasElement&&u instanceof HTMLCanvasElement))throw new Error("Elements are not canvas tags");if(l===null||p===null)throw new Error("Unable to retrive 2d context from canvas elements");l.fillStyle="#ccc",l.fillRect(0,0,a.width,a.height),n.board.forEach((t,i)=>{t.forEach((o,r)=>{o===1&&(l.fillStyle="yellow",l.fillRect(r,i,1,1))})}),n.piece.shape.forEach((t,i)=>{t.forEach((o,r)=>{o===1&&(l.fillStyle="red",l.fillRect(n.piece.position.x+r,n.piece.position.y+i,1,1))})}),p.fillStyle="#ccc",p.fillRect(0,0,u.width,u.height),n.nextShape.forEach((t,i)=>{t.forEach((o,r)=>{o===1&&(p.fillStyle="red",p.fillRect(r,i,1,1))})}),y.innerHTML=n.score.toString()}const M={ArrowUp:()=>{c=P(c)},ArrowDown:()=>{c=S(c)},ArrowLeft:()=>{c=T(c)},ArrowRight:()=>{c=O(c)}};window.document.addEventListener("keydown",function(n){const e=M[n.key]??void 0;e!==void 0&&e()});b(0);
